services:
    redis:
      image: redis:alpine
      ports:
        - "6379:6379"
    api:
      build: .
      ports:
        - "8000:8000"
      volumes:
        - .:/app
      depends_on:
        - redis
        - db
      env_file:
        - .env   
      environment:
        - CELERY_BROKER_URL=redis://redis:6379
      command: uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload
    worker:
      build: .
      depends_on:
        - redis
        - db
      env_file:
        - .env                                    # ← NEU! (für DB-Zugriff)
      environment:
        - CELERY_BROKER_URL=redis://redis:6379
      command: celery -A src.document.workers.pdf_worker worker --loglevel=info
    db:
      image: postgres:15-alpine
      environment:
        POSTGRES_USER: postgres
        POSTGRES_PASSWORD: postgres
        POSTGRES_DB: fastapi_db
      ports:
        - "5432:5432"
      volumes:
        - postgres_data:/var/lib/postgresql/data  

volumes:
  postgres_data:                                  
